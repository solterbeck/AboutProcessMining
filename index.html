<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Process Mining Bibliography</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        header {
            background-color: #007bff;
            color: white;
            padding: 15px 20px;
        }
        header h1 {
            margin: 0;
            font-size: 1.5rem;
        }
        header nav {
            margin-top: 10px;
        }
        header nav a {
            color: white;
            margin-right: 15px;
            text-decoration: none;
            font-weight: bold;
        }
        header nav a:hover {
            text-decoration: underline;
        }
        .search-container {
            margin: 20px 0;
            position: relative;
        }
        #searchInput {
            padding-right: 30px;
        }
        .clear-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 1.2rem;
            color: #aaa;
        }
        .clear-btn:hover {
            color: #000;
        }
        .filter-buttons {
            margin-bottom: 20px;
        }
        .filter-buttons button {
            margin-right: 10px;
        }
        .accordion-button:not(.collapsed) {
            color: #007bff;
            background-color: #e9ecef;
        }
        .accordion-button div {
            text-align: left;
        }
        .accordion-button strong {
            font-size: 1rem;
        }
        .accordion-button small {
            font-size: 0.9rem;
            color: #555;
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <header>
        <h1>All About Process Mining</h1>
        <nav>
            <a href="#bibliography">Bibliography</a>
            <a href="#imprint">Imprint</a>
        </nav>
    </header>

    <div class="pagination" id="pagination" style="margin-top: 20px; display: flex; justify-content: center;">
        <!-- Pagination buttons will be dynamically rendered here -->
    </div>   

    <div class="container">
        <!-- Search and Filter Bar -->
        <div class="search-container">
            <input type="text" id="searchInput" class="form-control" placeholder="Search in Title, Author, Editor, Tags, and Abstract">
            <span class="clear-btn" id="clearSearch">&times;</span>
        </div>
        <div class="filter-buttons">
            <button class="btn btn-primary" id="filterAll">All</button>
            <button class="btn btn-outline-primary" id="filter2016">from 2016</button>
            <button class="btn btn-outline-primary" id="filter2000">from 2000</button>
            <button class="btn btn-outline-primary" id="filterBefore2000">before 2000</button>
            <button class="btn btn-outline-primary" id="filterNew">New Entries</button>
        </div>

        <!-- Bibliography List with Accordion -->
        <div class="accordion" id="bibliographyAccordion">
            <!-- Dynamic content will be rendered here -->
        </div>

        <div id="pagination">
            <!-- Dynamic Pagination Content -->
        </div>        
    </div>

    <script>
        let data = null;
        let filteredData = [];

        const rowsPerPage = 5; // Number of rows per page
        let currentPage = 1;

        function renderPagination(data) {
            const totalPages = Math.ceil(data.length / rowsPerPage);
            const paginationContainer = $("#pagination");
            paginationContainer.empty();

            const visiblePages = 5; // Number of page buttons visible at a time
            const halfVisible = Math.floor(visiblePages / 2);
            const startPage = Math.max(1, currentPage - halfVisible);
            const endPage = Math.min(totalPages, startPage + visiblePages - 1);

            // "Previous" button
            const prevButton = $(`
                <button class="btn btn-outline-primary ${currentPage === 1 ? 'disabled' : ''}" id="prevPage">Previous</button>
            `);
            prevButton.on("click", function () {
                if (currentPage > 1) {
                    currentPage--;
                    updateBibliographyAndPagination();
                }
            });
            paginationContainer.append(prevButton);

            // Page buttons
            for (let i = startPage; i <= endPage; i++) {
                const pageButton = $(`
                    <button class="btn ${i === currentPage ? 'btn-primary' : 'btn-outline-primary'} page-button">${i}</button>
                `);
                pageButton.on("click", function () {
                    currentPage = i;
                    updateBibliographyAndPagination();
                });
                paginationContainer.append(pageButton);
            }

            // Ellipsis before first page (if needed)
            if (startPage > 1) {
                paginationContainer.prepend(`<button class="btn btn-outline-secondary disabled">...</button>`);
            }

            // Ellipsis after last page (if needed)
            if (endPage < totalPages) {
                paginationContainer.append(`<button class="btn btn-outline-secondary disabled">...</button>`);
            }

            // "Next" button
            const nextButton = $(`
                <button class="btn btn-outline-primary ${currentPage === totalPages ? 'disabled' : ''}" id="nextPage">Next</button>
            `);
            nextButton.on("click", function () {
                if (currentPage < totalPages) {
                    currentPage++;
                    updateBibliographyAndPagination();
                }
            });
            paginationContainer.append(nextButton);
        }

        // Update the bibliography list and render pagination
        function updateBibliographyAndPagination() {
            const start = (currentPage - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const paginatedData = filteredData.slice(start, end);
            renderBibliographyList(paginatedData);
            renderPagination(filteredData);
        }


        // Load the data dynamically
        $.getJSON('library_full_data.json', function(response) {
            data = response;
            filteredData = [...data];
            renderBibliographyList(filteredData);
        });

        function renderBibliographyList(data) {
            const accordion = $("#bibliographyAccordion");
            accordion.empty();

            data.forEach((item, index) => {
                const entry = `
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="heading${index}">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${index}" aria-expanded="false" aria-controls="collapse${index}">
                                <div>
                                    <strong>${item.Title || 'N/A'}</strong><br>
                                    <small>${item.Author || 'N/A'}</small>
                                </div>
                            </button>
                        </h2>
                        <div id="collapse${index}" class="accordion-collapse collapse" aria-labelledby="heading${index}" data-bs-parent="#bibliographyAccordion">
                            <div class="accordion-body">
                                <p><strong>Author(s):</strong> ${item.Author || 'N/A'}</p>
                                <p><strong>Editor(s):</strong> ${item.Editor || 'N/A'}</p>
                                <p><strong>Item Type:</strong> ${item.ItemType || 'N/A'}</p>
                                <p><strong>Publication Title:</strong> ${item.PublicationTitle || 'N/A'}</p>
                                <p><strong>Publisher / Year / Pages / Language:</strong> 
                                    ${item.Publisher || '-'} / ${item.PublicationYear || '-'} / ${item.Pages || '-'} / ${item.Language || 'N/A'}
                                </p>
                                <p><strong>Tags:</strong> ${item.ManualTags || 'N/A'}</p>
                                <p><strong>Abstract:</strong> ${item.AbstractNote || 'N/A'}</p>
                                <p><strong>Source:</strong> 
                                    <a href="${item.Url || '#'}" target="_blank">Download or link to the source</a>
                                </p>
                            </div>
                        </div>
                    </div>
                `;
                accordion.append(entry);
            });
        }

        // Filter Buttons Functionality
        function activateFilterButton(buttonId) {
            // Clear the active class from all filter buttons
            $(".filter-buttons button").removeClass("btn-primary").addClass("btn-outline-primary");

            // Add the active class to the clicked button
            $(`#${buttonId}`).removeClass("btn-outline-primary").addClass("btn-primary");
        }

        $("#filterAll").on("click", function () {
            activateFilterButton("filterAll");
            filteredData = [...data];
            currentPage = 1; // Reset to the first page
            updateBibliographyAndPagination();
        });

        $("#filter2016").on("click", function () {
            activateFilterButton("filter2016");
            filteredData = data.filter(item => parseInt(item.PublicationYear) >= 2016);
            renderBibliographyList(filteredData);
        });

        $("#filter2000").on("click", function () {
            activateFilterButton("filter2000");
            filteredData = data.filter(item => parseInt(item.PublicationYear) >= 2000);
            renderBibliographyList(filteredData);
        });

        $("#filterBefore2000").on("click", function () {
            activateFilterButton("filterBefore2000");
            filteredData = data.filter(item => parseInt(item.PublicationYear) < 2000);
            renderBibliographyList(filteredData);
        });

        $("#filterNew").on("click", function () {
            activateFilterButton("filterNew");
            // Logic for new entries (if defined) goes here
            filteredData = data.filter(item => item.isNew); // Example logic
            renderBibliographyList(filteredData);
        });

        // Search Functionality
        $("#searchInput").on("input", function () {
            const query = $(this).val().toLowerCase();
            filteredData = data.filter(item => 
                [
                    item.Title,
                    item.Author,
                    item.Editor,
                    item.ItemType,
                    item.PublicationTitle,
                    item.Publisher,
                    item.PublicationYear,
                    item.Pages,
                    item.Language,
                    item.ManualTags,
                    item.AbstractNote,
                    item.Url
                ]
                .some(val => (val || '').toString().toLowerCase().includes(query))
            );
            renderBibliographyList(filteredData);
            updateBibliographyAndPagination();
        });

        // Clear search field functionality
        $("#clearSearch").on("click", function () {
            $("#searchInput").val(""); // Clear the input
            $("#searchInput").trigger("input"); // Trigger input event to refresh the list
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>
</html>
